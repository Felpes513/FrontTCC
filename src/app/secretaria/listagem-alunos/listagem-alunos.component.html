<section class="painel" [class.loading]="loading()">
  <header class="head">
    <h3 *ngIf="modo === 'SECRETARIA'">Inscritos ({{ total() }})</h3>
    <h3 *ngIf="modo === 'ORIENTADOR'">Selecionar alunos ({{ total() }})</h3>
  </header>

  <!-- Loading -->
  <ng-container *ngIf="loading(); else conteudo">
    <div class="skeleton">
      <div class="sk-row" *ngFor="let i of [1,2,3,4]"></div>
    </div>
  </ng-container>

  <ng-template #conteudo>
    <!-- ======== MODO SECRETARIA (layout antigo) ======== -->
    <ng-container *ngIf="modo === 'SECRETARIA'">
      <ng-container *ngIf="lista().length; else vazio">
        <ul class="lista" role="list">
          <li class="item" *ngFor="let a of lista()">
            <div class="dados">
              <strong class="nome" title="{{ a.nome }}">{{ a.nome }}</strong>
              <div class="mini">
                <span>RA: {{ a.matricula }}</span>
                <span class="sep">•</span>
                <span>Email: {{ a.email }}</span>
                <span class="sep">•</span>
                <span>Status: <b>{{ a.status }}</b></span>
              </div>

              <div class="links" *ngIf="a.documentoNotasUrl">
                <a [href]="a.documentoNotasUrl" target="_blank" rel="noopener">
                  <i class="fas fa-file-alt"></i> Visualizar Notas
                </a>
              </div>
            </div>
          </li>
        </ul>
      </ng-container>
    </ng-container>

    <!-- ======== MODO ORIENTADOR (seleção) ======== -->
    <ng-container *ngIf="modo === 'ORIENTADOR'">
      <!-- Aprovados -->
      <div *ngIf="aprovadas.length; else nenhumAprovado">
        <h4>Aprovados pela Secretaria</h4>
        <ul class="lista" role="list">
          <li class="item" *ngFor="let i of aprovadas">
            <label class="linha">
              <input
                type="checkbox"
                [checked]="selecionados.has(alunoId(i))"
                [disabled]="disabledCheckbox(i)"
                (change)="toggleSelecionado(i, $any($event.target).checked)"
              />
              <div class="dados">
                <strong class="nome">{{ alunoNome(i) }}</strong>
                <div class="mini">
                  <span>ID Aluno: {{ alunoId(i) }}</span>
                  <span class="sep">•</span>
                  <span>Status: <b>APROVADO</b></span>
                </div>
              </div>
            </label>
          </li>
        </ul>
      </div>
      <ng-template #nenhumAprovado>
        <p class="muted">Nenhum aluno aprovado pela Secretaria ainda.</p>
      </ng-template>

      <!-- Pendentes / Reprovados -->
      <h4 style="margin-top:12px;">Pendentes / Reprovados</h4>
      <ul class="lista" *ngIf="pendentesOuReprovadas.length">
        <li class="item" *ngFor="let i of pendentesOuReprovadas">
          <div class="dados">
            <strong class="nome">{{ alunoNome(i) }}</strong>
            <div class="mini">
              <span>ID Aluno: {{ alunoId(i) }}</span>
              <span class="sep">•</span>
              <span>Status: <b>{{ (i?.status || i?.situacao || 'PENDENTE') | uppercase }}</b></span>
            </div>
          </div>
        </li>
      </ul>

      <!-- Ações -->
      <div class="form-actions" style="margin-top: 12px;">
        <button type="button"
                (click)="salvarSelecao()
                "
                [disabled]="salvandoSelecao || (limite>0 && selecionados.size>limite)">
          {{ salvandoSelecao ? 'Salvando...' : 'Salvar seleção' }}
        </button>
        <span class="ok" *ngIf="sucessoSelecao">{{ sucessoSelecao }}</span>
        <span class="erro" *ngIf="erroSalvarSelecao">{{ erroSalvarSelecao }}</span>
        <div class="mini" style="margin-top: 4px;">
          Selecionados: {{ selecionados.size }}
          <span *ngIf="limite">/ Limite: {{ limite }}</span>
        </div>
      </div>
    </ng-container>
  </ng-template>

  <!-- Estado vazio (SECRETARIA) -->
  <ng-template #vazio>
    <div class="vazio">
      <h4>Nenhum aluno inscrito ainda</h4>
      <p>Quando houver inscrições neste projeto, elas aparecerão aqui.</p>
    </div>
  </ng-template>
</section>
