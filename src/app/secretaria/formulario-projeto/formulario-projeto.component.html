<h2>{{ tituloPagina }}</h2>

<div class="editor-grid">
  <div class="col-form">
    <form class="form-container" (ngSubmit)="salvarProjeto()" *ngIf="projeto">
      <!-- Nome do Projeto -->
      <label for="titulo"><i class="fas fa-book"></i> Título do Projeto</label>
      <input
        id="titulo"
        type="text"
        [(ngModel)]="projeto.titulo_projeto"
        name="titulo_projeto"
        required
        [disabled]="isOrientadorMode"
      />

      <!-- Resumo do Projeto -->
      <label for="resumo"
        ><i class="fas fa-align-left"></i> Resumo do Projeto</label
      >
      <textarea
        id="resumo"
        [(ngModel)]="projeto.resumo"
        name="resumo"
        required
        [disabled]="isOrientadorMode"
      ></textarea>

      <!-- Filtro de Orientador -->
      <label for="buscaOrientador"
        ><i class="fas fa-search"></i> Buscar Orientador</label
      >
      <input
        id="buscaOrientador"
        type="text"
        [(ngModel)]="buscaOrientador"
        (input)="filtrarOrientadores()"
        name="busca_orientador"
        placeholder="Digite o nome do orientador"
        [disabled]="isOrientadorMode"
      />

      <!-- Selecionar Orientador -->
      <label for="selectOrientador"
        ><i class="fas fa-user-tie"></i> Selecionar Orientador</label
      >
      <select
        id="selectOrientador"
        [(ngModel)]="orientadorSelecionadoId"
        (change)="selecionarOrientador($event)"
        required
        name="orientadorSelecionadoId"
        [disabled]="isOrientadorMode"
      >
        <option value="">-- Selecione --</option>
        <option
          *ngFor="let orientador of orientadoresFiltrados"
          [value]="orientador.id"
        >
          {{ orientador.nome_completo }}
        </option>
      </select>

      <!-- E-mail do Orientador -->
      <label for="email_orientador"
        ><i class="fas fa-envelope"></i> E-mail do Orientador</label
      >
      <input
        id="email_orientador"
        type="email"
        [value]="emailOrientador"
        name="email_orientador"
        readonly
      />

      <!-- Campus -->
      <label for="selectCampus"><i class="fas fa-building"></i> Campus</label>
      <select
        id="selectCampus"
        [(ngModel)]="campusSelecionadoId"
        (change)="selecionarCampus($event)"
        required
        name="campusSelecionadoId"
        [disabled]="isOrientadorMode"
      >
        <option value="">-- Selecione --</option>
        <option
          *ngFor="let campus of campusFiltrados"
          [value]="campus.id_campus"
        >
          {{ campus.campus }}
        </option>
      </select>

      <!-- Ações -->
      <div class="form-actions" *ngIf="!isOrientadorMode">
        <button type="submit">
          <i class="fas fa-save"></i> {{ textoBotao }}
        </button>
        <button type="button" class="btn-cancel" (click)="voltar()">
          <i class="fas fa-arrow-left"></i> Cancelar
        </button>
      </div>

      <!-- Orientador: apenas Voltar (salvar seleção fica na coluna direita) -->
      <div class="form-actions" *ngIf="isOrientadorMode">
        <button type="button" class="btn-cancel" (click)="voltar()">
          <i class="fas fa-arrow-left"></i> Voltar
        </button>
      </div>
    </form>
  </div>

  <!-- COLUNA DIREITA -->
  <div class="col-inscritos" *ngIf="projetoId > 0">
    <app-listagem-alunos
      [projetoId]="projetoId"
      [modo]="isOrientadorMode ? 'ORIENTADOR' : 'SECRETARIA'"
    >
    </app-listagem-alunos>
  </div>

  <!-- Orientador: seleção de alunos aprovados -->
  <ng-template #blocoOrientador>
    <section class="painel">
      <header class="head">
        <h3>Selecionar alunos aprovados</h3>
        <div class="mini">
          Limite: {{ limite || "—" }} | Selecionados: {{ selecionados.size }}
        </div>
      </header>

      <!-- Aprovados (selecionáveis) -->
      <div *ngIf="aprovadas.length; else nenhumAprovado">
        <ul class="lista" role="list">
          <li class="item" *ngFor="let i of aprovadas">
            <label class="linha">
              <input
                type="checkbox"
                [checked]="selecionados.has(alunoId(i))"
                [disabled]="disabledCheckbox(i)"
                (change)="toggleSelecionado(i, $any($event.target).checked)"
              />
              <div class="dados">
                <strong class="nome">{{ alunoNome(i) }}</strong>
                <div class="mini">
                  <span>ID Aluno: {{ alunoId(i) }}</span>
                  <span class="sep">•</span>
                  <span>Status: <b>APROVADO</b></span>
                </div>
              </div>
            </label>
          </li>
        </ul>
      </div>
      <ng-template #nenhumAprovado>
        <p class="muted">Nenhum aluno aprovado pela Secretaria ainda.</p>
      </ng-template>

      <!-- Pendentes / Reprovados (visualização) -->
      <h4 style="margin-top: 12px">Pendentes / Reprovados</h4>
      <ul class="lista" *ngIf="pendentesOuReprovadas.length">
        <li class="item" *ngFor="let i of pendentesOuReprovadas">
          <div class="dados">
            <strong class="nome">{{ alunoNome(i) }}</strong>
            <div class="mini">
              <span>ID Aluno: {{ alunoId(i) }}</span>
              <span class="sep">•</span>
              <span
                >Status:
                <b>{{
                  i?.status || i?.situacao || "PENDENTE" | uppercase
                }}</b></span
              >
            </div>
          </div>
        </li>
      </ul>

      <!-- Ações de salvar seleção -->
      <div class="form-actions" style="margin-top: 12px">
        <button
          type="button"
          (click)="salvarSelecao()"
          [disabled]="
            salvandoSelecao || (limite > 0 && selecionados.size > limite)
          "
        >
          {{ salvandoSelecao ? "Salvando..." : "Salvar seleção" }}
        </button>
        <span class="ok" *ngIf="sucessoSelecao">{{ sucessoSelecao }}</span>
        <span class="erro" *ngIf="erroSalvarSelecao">{{
          erroSalvarSelecao
        }}</span>
      </div>
    </section>
  </ng-template>
</div>
