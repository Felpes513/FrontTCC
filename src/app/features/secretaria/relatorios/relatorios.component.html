<h2>Relatórios</h2>

<!-- Barra de ações -->
<div class="toolbar">
  <div class="mes-picker">
    <label for="mes"><i class="far fa-calendar-alt"></i> Mês de referência</label>
    <input id="mes" type="month" [(ngModel)]="mes" (change)="atualizarMes()" />
  </div>

  <button class="btn" [disabled]="baixando" (click)="baixarAlunosXlsx()">
    <i class="fas fa-file-excel"></i>
    {{ baixando ? 'Gerando...' : 'Baixar Alunos (XLSX)' }}
  </button>
</div>

<!-- Estado de carregamento/erro -->
<div *ngIf="carregandoMensal" class="loading">Carregando relatórios do mês…</div>
<div *ngIf="!carregandoMensal && erroMensal" class="erro">{{ erroMensal }}</div>

<!-- Grid -->
<div class="grid">
  <!-- Recebidos -->
  <section class="card">
    <header>
      <h3><i class="fas fa-check-circle"></i> Recebidos no mês</h3>
      <span class="badge">{{ recebidos.length }}</span>
    </header>

    <div *ngIf="!recebidos.length && !carregandoMensal" class="empty">
      Nenhum relatório confirmado para {{ mes }}.
    </div>

    <table *ngIf="recebidos.length">
      <thead>
        <tr>
          <th>Projeto</th>
          <th>Orientador</th>
          <th>Mês</th>
          <th>Status</th>
          <th>Confirmado em</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of recebidos">
          <td>{{ r.titulo_projeto }}</td>
          <td>{{ r.orientador_nome || '—' }}</td>
          <td>{{ r.mes }}</td>
          <td>
            <span class="status" [class.ok]="r.ok" [class.nok]="!r.ok">
              {{ r.ok ? 'OK' : 'Pendente' }}
            </span>
            <span class="obs" *ngIf="r.observacao">— {{ r.observacao }}</span>
          </td>
          <td>{{ dataBr(r.confirmado_em) }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Pendentes -->
  <section class="card">
    <header>
      <h3><i class="fas fa-exclamation-circle"></i> Pendências no mês</h3>
      <span class="badge warn">{{ pendentes.length }}</span>
    </header>

    <div *ngIf="!pendentes.length && !carregandoMensal" class="empty">
      Nenhuma pendência para {{ mes }}.
    </div>

    <table *ngIf="pendentes.length">
      <thead>
        <tr>
          <th>Projeto</th>
          <th>Orientador</th>
          <th>Mês</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of pendentes">
          <td>{{ p.titulo_projeto }}</td>
          <td>{{ p.orientador_nome || '—' }}</td>
          <td>{{ p.mes || mes }}</td>
        </tr>
      </tbody>
    </table>
  </section>
</div>
