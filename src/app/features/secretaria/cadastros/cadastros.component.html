<!-- antes: <section class="card" [class.loading]="carregando"> -->
<section class="cadastros" [class.loading]="carregando">
  <header class="tabs">
    <button
      class="tab"
      [class.active]="aba === 'APROVACoes'"
      (click)="setAba('APROVACoes')"
    >
      Aprovações
    </button>
    <button
      class="tab"
      [class.active]="aba === 'INADIMPLENTES'"
      (click)="setAba('INADIMPLENTES')"
    >
      Inadimplentes
    </button>

    <ng-container *ngIf="aba === 'APROVACoes'">
      <div class="split"></div>
      <button
        class="subtab"
        [class.active]="tipo === 'ALUNOS'"
        (click)="setTipo('ALUNOS')"
      >
        Alunos
      </button>
      <button
        class="subtab"
        [class.active]="tipo === 'ORIENTADORES'"
        (click)="setTipo('ORIENTADORES')"
      >
        Orientadores
      </button>

      <div class="toolbar" style="margin-left: auto; min-width: 260px">
        <div class="search" style="width: 100%">
          <span class="icon"><i class="fas fa-search"></i></span>
          <input
            type="text"
            placeholder="filtrar por nome/email/cpf"
            [(ngModel)]="filtro"
          />
        </div>
      </div>
    </ng-container>
  </header>

  <div *ngIf="erro" class="erro">{{ erro }}</div>

  <!-- ALUNOS -->
  <table
    class="table"
    *ngIf="!carregando && aba === 'APROVACoes' && tipo === 'ALUNOS'"
  >
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>CPF</th>
        <th>Status</th>
        <th>PDF</th>
        <th class="col-actions">Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let a of alunos"
        [hidden]="filtro && !match(filtro, a.nome_completo, a.email, a.cpf)"
      >
        <td data-label="Nome">{{ a.nome_completo }}</td>
        <td data-label="Email">{{ a.email }}</td>
        <td data-label="CPF">{{ a.cpf }}</td>
        <td data-label="Status">
          <span
            class="badge"
            [class.aprovado]="a.status === 'APROVADO'"
            [class.reprovado]="a.status === 'REPROVADO'"
            [class.pendente]="!a.status"
          >
            {{ a.status || "—" }}
          </span>
        </td>
        <td data-label="PDF">{{ a.has_pdf ? "✓" : "—" }}</td>
        <td class="col-actions" data-label="Ações">
          <button
            class="btn btn-approve"
            (click)="aprovar(a.id)"
            [disabled]="a.status === 'APROVADO'"
          >
            Aprovar
          </button>
          <button
            class="btn btn-reject"
            (click)="reprovar(a.id)"
            [disabled]="a.status === 'REPROVADO'"
          >
            Reprovar
          </button>
          <a
            *ngIf="a.has_pdf"
            class="btn"
            [href]="'/api/alunos/' + a.id + '/pdf'"
            target="_blank"
            >PDF</a
          >
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ORIENTADORES -->
  <table
    class="table"
    *ngIf="!carregando && aba === 'APROVACoes' && tipo === 'ORIENTADORES'"
  >
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>CPF</th>
        <th>Status</th>
        <th class="col-actions">Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let o of orientadores"
        [hidden]="filtro && !match(filtro, o.nome_completo, o.email, o.cpf)"
      >
        <td data-label="Nome">{{ o.nome_completo }}</td>
        <td data-label="Email">{{ o.email }}</td>
        <td data-label="CPF">{{ o.cpf }}</td>
        <td data-label="Status">
          <span
            class="badge"
            [class.aprovado]="o.status === 'APROVADO'"
            [class.reprovado]="o.status === 'REPROVADO'"
            [class.pendente]="!o.status"
          >
            {{ o.status || "—" }}
          </span>
        </td>
        <td class="col-actions" data-label="Ações">
          <button
            class="btn btn-approve"
            (click)="aprovar(o.id)"
            [disabled]="o.status === 'APROVADO'"
          >
            Aprovar
          </button>
          <button
            class="btn btn-reject"
            (click)="reprovar(o.id)"
            [disabled]="o.status === 'REPROVADO'"
          >
            Reprovar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- INADIMPLENTES -->
  <ng-container *ngIf="!carregando && aba === 'INADIMPLENTES'">
    <h3>Alunos</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>CPF</th>
          <th>Inadimplente até</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of alunosInad">
          <td data-label="Nome">{{ a.nome_completo }}</td>
          <td data-label="Email">{{ a.email }}</td>
          <td data-label="CPF">{{ a.cpf }}</td>
          <td data-label="Inadimplente até">
            {{ a.inadimplente_ate | date : "shortDate" }}
          </td>
        </tr>
      </tbody>
    </table>

    <h3>Orientadores</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>CPF</th>
          <th>Inadimplente até</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of orientadoresInad">
          <td data-label="Nome">{{ o.nome_completo }}</td>
          <td data-label="Email">{{ o.email }}</td>
          <td data-label="CPF">{{ o.cpf }}</td>
          <td data-label="Inadimplente até">
            {{ o.inadimplente_ate | date : "shortDate" }}
          </td>
        </tr>
      </tbody>
    </table>
  </ng-container>
</section>
