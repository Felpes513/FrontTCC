<h2>{{ tituloPagina }}</h2>

<div class="page">
  <div class="editor-grid">
    <div class="col-form">
      <form class="form-container" (ngSubmit)="salvarProjeto()" *ngIf="projeto">
        <label for="titulo"
          ><i class="fas fa-book"></i> Título do Projeto</label
        >
        <input
          id="titulo"
          type="text"
          [(ngModel)]="projeto.titulo_projeto"
          name="titulo_projeto"
          required
          [disabled]="isOrientadorMode"
        />

        <label for="resumo"
          ><i class="fas fa-align-left"></i> Resumo do Projeto</label
        >
        <textarea
          id="resumo"
          [(ngModel)]="projeto.resumo"
          name="resumo"
          required
          [disabled]="isOrientadorMode"
        ></textarea>

        <label for="buscaOrientador"
          ><i class="fas fa-search"></i> Buscar Orientador</label
        >
        <input
          id="buscaOrientador"
          type="text"
          [(ngModel)]="buscaOrientador"
          (input)="filtrarOrientadores()"
          name="busca_orientador"
          placeholder="Digite o nome do orientador"
          [disabled]="isOrientadorMode"
        />

        <label for="selectOrientador"
          ><i class="fas fa-user-tie"></i> Selecionar Orientador</label
        >
        <select
          id="selectOrientador"
          [(ngModel)]="orientadorSelecionadoId"
          (change)="selecionarOrientador($event)"
          required
          name="orientadorSelecionadoId"
          [disabled]="isOrientadorMode"
        >
          <option value="">-- Selecione --</option>
          <option
            *ngFor="let orientador of orientadoresFiltrados"
            [value]="orientador.id"
          >
            {{ orientador.nome_completo }}
          </option>
        </select>

        <label for="email_orientador"
          ><i class="fas fa-envelope"></i> E-mail do Orientador</label
        >
        <input
          id="email_orientador"
          type="email"
          [value]="emailOrientador"
          name="email_orientador"
          readonly
        />

        <label for="selectCampus"><i class="fas fa-building"></i> Campus</label>
        <select
          id="selectCampus"
          [(ngModel)]="campusSelecionadoId"
          (change)="selecionarCampus($event)"
          required
          name="campusSelecionadoId"
          [disabled]="isOrientadorMode"
        >
          <option value="">-- Selecione --</option>
          <option
            *ngFor="let campus of campusFiltrados"
            [value]="campus.id_campus"
          >
            {{ campus.campus }}
          </option>
        </select>

        <div class="notas-section" *ngIf="modoEdicao">
          <h3><i class="fas fa-graduation-cap"></i> Notas do Projeto</h3>
          <p class="notas-description">
            As notas abaixo são referentes ao projeto como um todo e podem ser
            editadas apenas pela Secretaria.
          </p>

          <div class="notas-grid">
            <div class="nota-card">
              <label for="nota1"
                ><i class="fas fa-star"></i> Nota 1 (Primeiro Semestre)</label
              >
              <input
                type="number"
                id="nota1"
                min="0"
                max="10"
                step="0.1"
                placeholder="0.0"
                [(ngModel)]="projeto.nota1"
                name="nota1"
                [disabled]="isOrientadorMode"
              />
              <div class="nota-info">
                <span>Máximo: 10.0</span>
                <span
                  class="nota-status"
                  [class.aprovado]="(projeto.nota1 ?? 0) >= 6"
                  [class.reprovado]="
                    (projeto.nota1 ?? 0) > 0 && (projeto.nota1 ?? 0) < 6
                  "
                  [class.pendente]="projeto.nota1 == null"
                >
                  {{
                    (projeto.nota1 ?? 0) >= 6
                      ? "✓ Aprovado"
                      : (projeto.nota1 ?? 0) > 0
                      ? "✗ Reprovado"
                      : "⏳ Pendente"
                  }}
                </span>
              </div>
            </div>

            <div class="nota-card">
              <label for="nota2"
                ><i class="fas fa-star"></i> Nota 2 (Segundo Semestre)</label
              >
              <input
                type="number"
                id="nota2"
                min="0"
                max="10"
                step="0.1"
                placeholder="0.0"
                [(ngModel)]="projeto.nota2"
                name="nota2"
                [disabled]="isOrientadorMode"
              />
              <div class="nota-info">
                <span>Máximo: 10.0</span>
                <span
                  class="nota-status"
                  [class.aprovado]="(projeto.nota2 ?? 0) >= 6"
                  [class.reprovado]="
                    (projeto.nota2 ?? 0) > 0 && (projeto.nota2 ?? 0) < 6
                  "
                  [class.pendente]="projeto.nota2 == null"
                >
                  {{
                    (projeto.nota2 ?? 0) >= 6
                      ? "✓ Aprovado"
                      : (projeto.nota2 ?? 0) > 0
                      ? "✗ Reprovado"
                      : "⏳ Pendente"
                  }}
                </span>
              </div>
            </div>

            <div class="nota-card">
              <label for="notaFinal"
                ><i class="fas fa-trophy"></i> Nota Final</label
              >
              <input
                type="number"
                id="notaFinal"
                min="0"
                max="10"
                step="0.1"
                placeholder="0.0"
                [(ngModel)]="projeto.notaFinal"
                name="notaFinal"
                [disabled]="isOrientadorMode"
              />
              <div class="nota-info">
                <span>Máximo: 10.0</span>
                <span
                  class="nota-status"
                  [class.aprovado]="(projeto.notaFinal ?? 0) >= 6"
                  [class.reprovado]="
                    (projeto.notaFinal ?? 0) > 0 && (projeto.notaFinal ?? 0) < 6
                  "
                  [class.pendente]="projeto.notaFinal == null"
                >
                  {{
                    (projeto.notaFinal ?? 0) >= 6
                      ? "✓ Aprovado"
                      : (projeto.notaFinal ?? 0) > 0
                      ? "✗ Reprovado"
                      : "⏳ Pendente"
                  }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="upload-section" *ngIf="modoEdicao">
          <h3><i class="fas fa-file-upload"></i> Documentos do projeto</h3>

          <div class="upload-row">
            <label for="docxFile"
              ><i class="fas fa-file-word"></i> Projeto (.docx)</label
            >
            <div class="upload-controls">
              <input
                type="file"
                id="docxFile"
                accept=".docx"
                (change)="onFileSelected($event, 'docx')"
                aria-label="Selecionar arquivo DOCX"
              />
              <div class="upload-buttons">
                <button
                  type="button"
                  class="btn-upload"
                  (click)="enviarArquivo('docx')"
                  [disabled]="!arquivoDocx"
                  title="Enviar DOCX"
                >
                  <i class="fas fa-upload"></i> Upload
                </button>
                <button
                  type="button"
                  class="btn-download"
                  (click)="baixarArquivo('docx')"
                  title="Baixar DOCX"
                >
                  <i class="fas fa-download"></i> Baixar
                </button>
              </div>
            </div>
            <small class="hint" *ngIf="!arquivoDocx"
              >Selecione um arquivo .docx para habilitar o upload.</small
            >
          </div>

          <div class="upload-row">
            <label for="pdfFile"
              ><i class="fas fa-file-pdf"></i> Projeto (.pdf)</label
            >
            <div class="upload-controls">
              <input
                type="file"
                id="pdfFile"
                accept=".pdf"
                (change)="onFileSelected($event, 'pdf')"
                aria-label="Selecionar arquivo PDF"
                [disabled]="isOrientadorMode"
              />
              <div class="upload-buttons">
                <button
                  type="button"
                  class="btn-upload"
                  (click)="enviarArquivo('pdf')"
                  [disabled]="isOrientadorMode || !arquivoPdf"
                  title="Enviar PDF"
                >
                  <i class="fas fa-upload"></i> Upload
                </button>
                <button
                  type="button"
                  class="btn-download"
                  (click)="baixarArquivo('pdf')"
                  title="Baixar PDF"
                >
                  <i class="fas fa-download"></i> Baixar
                </button>
              </div>
            </div>
            <small class="hint" *ngIf="!arquivoPdf && !isOrientadorMode"
              >Selecione um arquivo .pdf para habilitar o upload.</small
            >
            <small class="hint" *ngIf="isOrientadorMode"
              >Upload de PDF é realizado pela Secretaria.</small
            >
          </div>
        </div>

        <div class="form-actions" *ngIf="!isOrientadorMode">
          <button type="submit">
            <i class="fas fa-save"></i> {{ textoBotao }}
          </button>
          <button type="button" class="btn-cancel" (click)="voltar()">
            <i class="fas fa-arrow-left"></i> Cancelar
          </button>
        </div>

        <div class="form-actions" *ngIf="isOrientadorMode">
          <button type="button" class="btn-cancel" (click)="voltar()">
            <i class="fas fa-arrow-left"></i> Voltar
          </button>
        </div>
      </form>
    </div>

    <div class="col-inscritos" *ngIf="projetoId > 0">
      <app-listagem-alunos
        [projetoId]="projetoId"
        [modo]="isOrientadorMode ? 'ORIENTADOR' : 'SECRETARIA'"
      ></app-listagem-alunos>
    </div>
  </div>
</div>
