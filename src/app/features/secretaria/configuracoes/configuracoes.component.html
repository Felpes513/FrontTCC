<div class="config-page">
  <h2>Configurações do Sistema</h2>
  <p class="muted">Gerencie campus, cursos e bolsas</p>

  <mat-tab-group>
    <!-- ===== Campus ===== -->
    <mat-tab label="Campus">
      <div class="form-section">
        <h3>Cadastrar Campus</h3>
        <form (ngSubmit)="cadastrarCampus()">
          <input
            type="text"
            [(ngModel)]="novoCampus"
            name="nomeCampus"
            placeholder="Nome do campus"
            required
          />
          <button type="submit">Salvar</button>
        </form>

        <h4>Campus cadastrados</h4>
        <ul class="list">
          <li *ngFor="let c of campus">
            <span>{{ c.campus }}</span>
            <button class="danger" (click)="excluirCampus(c.id_campus)">
              Excluir
            </button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <!-- ===== Cursos ===== -->
    <mat-tab label="Cursos">
      <div class="form-section">
        <h3>Cadastrar Curso</h3>
        <form (ngSubmit)="cadastrarCurso()">
          <input
            type="text"
            [(ngModel)]="novoCurso"
            name="nomeCurso"
            placeholder="Nome do curso"
            required
          />
          <button type="submit">Salvar</button>
        </form>

        <h4>Cursos cadastrados</h4>
        <ul class="list">
          <li *ngFor="let c of cursos">
            <span>{{ c.nome }}</span>
            <button class="danger" (click)="excluirCurso(c.id_curso)">
              Excluir
            </button>
          </li>
        </ul>
      </div>
    </mat-tab>

    <mat-tab label="Bolsas">
      <div class="form-section">
        <h3>Cadastrar Bolsa</h3>
        <form (ngSubmit)="cadastrarBolsaAluno()" class="crud-inline">
          <select
            [(ngModel)]="formBolsa.id_aluno"
            name="idAluno"
            required
            title="Selecione o aluno"
          >
            <option [ngValue]="null" disabled selected>
              Selecione um aluno
            </option>
            <option *ngFor="let a of bolsas" [ngValue]="a.id_aluno">
              {{ a.nome_completo }} — {{ a.email }}
            </option>
          </select>

          <label style="margin: 0 0.5rem">
            <input
              type="checkbox"
              [(ngModel)]="formBolsa.possui_bolsa"
              name="possuiBolsa"
            />
            Bolsista?
          </label>

          <button type="submit">Salvar</button>
        </form>

        <div *ngIf="feedbackBolsa" class="muted" style="margin-top: 0.5rem">
          {{ feedbackBolsa }}
        </div>

        <hr class="section-divider" />

        <!-- ========== Atribuição para Alunos (deixa como está) ========== -->
        <h3>Alunos (atribuição de bolsas)</h3>
        <div class="bolsas-filter">
          <input
            type="text"
            [(ngModel)]="filtroBolsa"
            placeholder="Filtrar por nome ou e-mail"
          />
        </div>

        <div *ngIf="carregandoBolsas" class="loading">Carregando...</div>
        <div *ngIf="erroBolsas" class="error">{{ erroBolsas }}</div>

        <table class="table table-bolsas" *ngIf="!carregandoBolsas">
          <thead>
            <tr>
              <th class="center">Aluno</th>
              <th class="center">Email</th>
              <th class="center">Bolsista</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let r of bolsas"
              [hidden]="!matchBolsa(filtroBolsa, r.nome_completo, r.email)"
            >
              <td class="center">{{ r.nome_completo }}</td>
              <td class="center">{{ r.email }}</td>
              <td class="center">
                <label class="switch" title="Alternar status de bolsa">
                  <input
                    type="checkbox"
                    [checked]="r.possui_bolsa"
                    (change)="toggleBolsa(r)"
                    [attr.aria-label]="'Alternar bolsa de ' + r.nome_completo"
                    role="switch"
                  />
                  <span class="slider"></span>
                </label>
              </td>
            </tr>
          </tbody>
        </table>

        <p class="muted" *ngIf="!carregandoBolsas && bolsas.length === 0">
          Nenhum registro de aluno encontrado.
        </p>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
