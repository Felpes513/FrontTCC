<div class="modal-backdrop" (click)="fechar()"></div>
<div class="modal-card" role="dialog" aria-modal="true">
  <header>
    <h3>Enviar formulário de avaliação</h3>
    <button class="close" (click)="fechar()" aria-label="Fechar">×</button>
  </header>

  <section class="body">
    <div *ngIf="carregando" class="hint">Carregando…</div>
    <div *ngIf="erro" class="erro">{{ erro }}</div>

    <ng-container *ngIf="!carregando && !erro">
      <div class="row">
        <label>Projeto</label>
        <select [(ngModel)]="projetoSelecionado">
          <option value="">Enviar para <strong>todos</strong> os projetos</option>
          <option *ngFor="let p of projetos" [value]="p.id">{{ p.titulo }}</option>
        </select>
      </div>

      <ng-container *ngIf="projetoSelecionado">
        <div class="row">
          <label>Selecione <strong>2 avaliadores</strong> para este projeto</label>
          <div class="checklist">
            <label *ngFor="let a of avaliadores">
              <input type="checkbox"
                     [checked]="avaliadoresSelecionados.includes(a.id!)"
                     (change)="onToggle($event, a.id!)">
              <span>{{ a.nome }} — {{ a.email }}</span>
            </label>
          </div>
        </div>
      </ng-container>

      <div class="rule">
        Regra: cada projeto vai para <strong>2 avaliadores</strong>. Se houver empate, o sistema
        encaminha automaticamente para um <strong>3º avaliador</strong>.
      </div>

      <div class="msg sucesso" *ngIf="sucesso">{{ sucesso }}</div>
    </ng-container>
  </section>

  <footer>
    <button class="ghost" (click)="fechar()">Cancelar</button>
    <button class="primary" [disabled]="!podeEnviar || carregando" (click)="enviar()">
      Enviar
    </button>
  </footer>
</div>
